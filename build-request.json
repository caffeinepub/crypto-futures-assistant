{
  "kind": "build_request",
  "title": "Fix service worker incorrectly intercepting Binance API calls in Search tab",
  "projectName": "CryptoSMC Pro",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-12",
      "text": "Fix the service worker in frontend/public/service-worker.js so that requests to external API domains (fapi.binance.com, api.binance.com, api.coingecko.com, and any ICP/IC endpoints) are NEVER intercepted or cached — they must always pass through directly to the network. Remove any fetch event handler logic that returns a 503 offline error for these domains when the device has an active network connection. The offline 503 error response should only be triggered for those API domains when the device is genuinely offline (navigator.onLine === false). All app-shell and static asset caching behavior should remain unchanged.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "Binance API error 503: {\"error\":\"No live data available offline. Please check your connection.\"}",
          "o service worker precisa ser ajustado para não interceptar chamadas a domínios externos como fapi.binance.com, deixando essas requisições sempre ir direto para a rede"
        ]
      },
      "acceptanceCriteria": [
        "Opening the Search tab and searching for any Binance USD-M perpetual pair (e.g., BTCUSDT) successfully fetches live ticker and kline data without returning a 503 error while the device is online.",
        "The service worker fetch handler for fapi.binance.com, api.binance.com, and api.coingecko.com always calls fetch(event.request) and passes the response through directly when the device is online.",
        "When the device is genuinely offline (no network), the service worker correctly returns the explicit 503 JSON error for API domain requests instead of a network failure.",
        "App shell and static assets (HTML, JS, CSS, icons) continue to be served from the service worker cache for offline support.",
        "No regression on Market tab real-time ticker polling (every 5 seconds) or AI Trade tab kline fetching."
      ]
    }
  ],
  "constraints": [
    "Do not modify any file under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, or frontend/src/components/ui.",
    "Do not alter the PWA manifest or app-shell caching strategy — only fix the network-passthrough logic for external API domains."
  ],
  "nonGoals": [
    "Changing the SMC engine or analysis logic.",
    "Modifying Binance API authentication or HMAC signing utilities.",
    "Altering the Search tab UI or Open Positions display.",
    "Any backend (Motoko) changes."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}